<div class="flex justify-center flex-col lg:flex-row container mx-auto pb-4 select-none">
  <!-- Left panel: the grid -->
  <div class="inventory-view container">
    @for (row of hotmServ.grid; let rwIdx = $index; track rwIdx) {
      @for (cell of row; let colIdx = $index; track colIdx) {
        @if (cell) {
          <div class="inventory-slot rich-item"
               (click)="onCellClick(colIdx, rwIdx)"
               [id]="'cell_' + colIdx + '_' + rwIdx"
               [ngClass]="{'selected': selectedPos()?.x === colIdx && selectedPos()!.y === rwIdx}"
          >
            <div class="item-icon piece-icon" [ngClass]="cell.cssClass()()"></div>
          </div>
        } @else {
          <div class="inventory-slot" [id]="'cell_' + colIdx + '_' + rwIdx"></div>
        }
      }
    }
  </div>
  <!-- Right panel: the picker -->
  <div class="container flex justify-center flex-col max-lg:flex-col-reverse max-lg:mt-4 gap-3">
    <div id="tooltip-box" class="h-[50%] flex justify-center items-center">
      <div class="tooltip-mc px-3">
        @if (selectedPos()) {
          @let pos = selectedPos()!;
          @let selectedNode = hotmServ.grid[pos.y][pos.x];
          @switch (selectedNode.type) {
            @case ('ability') {
              <sb-hotm-card [instance]="selectedNode" [isLevelable]="false"/>
            }
            @case ('static') {
              <sb-hotm-card [instance]="selectedNode" [isLevelable]="false"/>
            }
            @case ('levelable') {
              <sb-hotm-card [instance]="selectedNode" [isLevelable]="true"/>
            }
          }
        } @else {
          <div class="flex flex-col justify-center items-center">
            <span class="mc gray">Select a perk to see its description!</span>
          </div>
        }
      </div>
    </div>
    <div class="h-[50%] flex justify-center items-center flex-col">
      <span class="font-semibold text-xl">Total</span>
      @let total = hotmServ.totalPowder();
      <span [innerHTML]="formattedPowderString(total.mithril, PowderType.MITHRIL) | colorize | parse | safeHtml"></span>
      <span [innerHTML]="formattedPowderString(total.gemstone, PowderType.GEMSTONE) | colorize | parse | safeHtml"></span>
      <span [innerHTML]="formattedPowderString(total.glacite, PowderType.GLACITE) | colorize | parse | safeHtml"></span>
      <br/>
      <span>Allowed tokens: {{ hotmServ.maxAllowedTokens }}</span>
    </div>
  </div>
</div>
