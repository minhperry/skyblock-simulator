<div class="container-sm d-flex justify-content-center flex-column flex-md-row my-3" data-bs-theme="dark">
  <!-- Tree grid view / Left side-->
  <div class="container inventory-view">
    @for (row of grid(); track _row; let _row = $index) {
      @for (node of row; track _item; let _item = $index) {
        @if (isNotNull(node)) {
          <div class="inventory-slot rich-item"
               (click)="onCellClick(_row, _item)"
               [ngClass]="(selected === node) ? (isUnlocked(node) ? 'selected' : 'selected-locked') : '' ">
            @if (node) {
              <div class="item-icon piece-icon" [ngClass]="getStateClass(node)"></div>
              @if (DEBUG) {
                <span class="user-select-none">{{ node!.state.currentLevel }}</span>
              }
            }
          </div>
        } @else {
          <div class="inventory-slot"></div>
        }
      }
    }
  </div>
  <!-- Perk view / Right side -->
  @if (selected) {
    <div class="container d-flex justify-content-center flex-column align-items-center">

      <div class="container d-flex justify-content-center flex-column align-items-center">
        <!-- Item-ahhhh tooltip -->
        <div class="tooltip-mc">
          <div id="name">
            {{ selected.perk.name }}
          </div>
          @if (isLevelable(selected)) {
            <div id="desc">
              <span class="mc gray">Level {{ selected.state.currentLevel }}</span>
              <span class="mc darkgray">/{{ selected.perk.maxLevel }}</span>
              <br/>
              <span [innerHTML]="getDescCalculated(selected) | parse | safeHtml"></span>
              <br/><br/>
              <span class="mc gray">Cost</span>
              <br>
              <span [innerHTML]="getPowderAmount(selected) | parse | safeHtml"></span>
            </div>
          } @else {
            <span [innerHTML]="selected.perk.description | colorize | parse | safeHtml"></span>
          }
        </div>
        <!-- Buttons -->
        <div class="d-flex justify-content-center flex-column">
          @if (isLevelable(selected)) {
            <div class="d-flex justify-content-center">
              @if (selected.state.state !== PerkState.LOCKED) {
                <button class="btn btn-primary m-1" (click)="modifySelectedLevel('min')">Min</button>
                @for (num of [1, -1, +10, -10]; track num) {
                  <button class="btn btn-primary m-1"
                          (click)="modifySelectedLevel(num)">{{ (num > 0) ? '+' : '' }}{{ num }}
                  </button>
                }
                <button class="btn btn-primary m-1" (click)="modifySelectedLevel('max')">Max</button>
              }
            </div>
          }
          @if (!isUnlocked(selected)) {
            <div class="d-flex justify-content-center">
              <button class="btn btn-primary m-1" (click)="unlockSelected()">Unlock Node</button>
            </div>
          }
        </div>
      </div>
    </div>
  }
</div>
<!-- External-ish butttons and display that does not have to do with selected perk -->
<div class="d-flex justify-content-center flex-row justify-content-around">
  @let locale = 'en-US';
  <div class="d-flex justify-content-center flex-column align-items-center">
    <div class="mc darkgreen">{{ totalPowder().mithril.toLocaleString(locale) }} Mithril Powder</div>
    <div class="mc purple">{{ totalPowder().gemstone.toLocaleString(locale) }} Gemstone Powder</div>
    <div class="mc aqua">{{ totalPowder().glacite.toLocaleString(locale) }} Glacite Powder</div>
  </div>
  <div>
    Remaining tokens: {{ tokens() }}
  </div>
</div>
<button (click)="DEBUG = !DEBUG">Togle debuk</button>