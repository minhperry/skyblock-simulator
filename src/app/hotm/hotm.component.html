<!--div class="flex justify-center flex-col lg:flex-row container mx-auto">
  <div class="inventory-view container">
    @for (row of grid; track r; let r = $index) {
      @for (node of row; track it; let it = $index) {
        @if (isNotNull(node)) {
          <div class="inventory-slot rich-item"
               (click)="onCellClick2(r, it)"
               [class.selected]="isSelectedEqualNode(selected, node)"
          >
            @if (node) {
              <div class="item-icon piece-icon" [ngClass]="getStateClass(node)"></div>
            }
          </div>
        } @else {
          <div class="inventory-slot"></div>
        }
      }
    }
  </div>
  <div class="flex justify-center container">
    <div class="my-auto tooltip-mc">
      @let selected = sigSelected();
      @if (selected) {
        @if (isLevelable(selected)) {
          <span class="mc gray">Level {{ selected.state.currentLevel }}</span>
          <span class="mc darkgray">/{{ selected.perk.maxLevel }}</span>
          <br/>
          <span [innerHTML]="getDescCalculated(selected) | parse | safeHtml"></span>
          <br/>
          <span class="mc gray">Cost</span>
          <br>
          <span [innerHTML]="getPowderAmount(selected) | parse | safeHtml"></span>

          <div class="flex justify-center">
            <p-button class="btn btn-primary m-1" (click)="modifySelectedLevel(1)">+1</p-button>
            <p-button class="btn btn-primary m-1" (click)="modifySelectedLevel(-1)">-1</p-button>
            <p-button class="btn btn-primary m-1" (click)="modifySelectedLevel(10)">+10</p-button>
            <p-button class="btn btn-primary m-1" (click)="modifySelectedLevel(-10)">-10</p-button>
          </div>
        } @else if (isAbility(selected)) {
          <span [innerHTML]="selected.perk.description | colorize | parse | safeHtml"></span>
        } @else {
          <span [innerHTML]="selected.perk.description | colorize | parse | safeHtml"></span>
        }
      } @else {
        <div class="flex flex-col justify-center items-center">
          <span class="mc gray">Select a perk to</span>
          <br/>
          <span class="mc gray">see its description!</span>
        </div>
      }
    </div>
  </div>
</div-->

<div class="flex justify-center flex-col lg:flex-row container mx-auto">
  <!-- Left panel: the grid -->
  <div class="inventory-view container">
    @for (row of hotmServ.grid; let rwIdx = $index; track rwIdx) {
      @for (cell of row; let colIdx = $index; track colIdx) {
        @if (cell) {
          <div class="inventory-slot rich-item"
               (click)="onCellClick(colIdx, rwIdx)"
               [id]="'cell_' + colIdx + '_' + rwIdx"
               [ngClass]="{'selected': selectedPos()?.x === colIdx && selectedPos()!.y === rwIdx}"
          >
            <div class="item-icon piece-icon" [ngClass]="cell.cssClass()()"></div>
          </div>
        } @else {
          <div class="inventory-slot" [id]="'cell_' + colIdx + '_' + rwIdx"></div>
        }
      }
    }
  </div>
  <!-- Right panel: the picker -->
  <div class="container flex justify-center">
    <div class="my-auto tooltip-mc">
      @if (selectedPos()) {
        @let pos = selectedPos()!;
        @let selectedNode = hotmServ.grid[pos.y][pos.x];
        @switch (selectedNode.type) {
          @case ('ability') {
            <sb-hotm-card [instance]="selectedNode" [isLevelable]="false"/>
          }
          @case ('static') {
            <sb-hotm-card [instance]="selectedNode" [isLevelable]="false"/>
          }
          @case ('levelable') {
            <sb-hotm-card [instance]="selectedNode" [isLevelable]="true"/>
          }
        }

        <!--div>


          <-- Description ->
          @if (levelable) {
            <span [innerHTML]="hotmServ.formattedDescription() | parse | safeHtml"></span>
          } @else {
            <span [innerHTML]="perkData.perk.description | colorize | parse | safeHtml "></span>
          }
          <-- Something something opened ->
          @let selState = hotmServ.currentSelectedState().data.state;
          <div class="flex justify-center mt-2">
            @if (selState === PerkState.LOCKED || selState === AbilityState.LOCKED) {
              <p-button severity="primary" (onClick)="hotmServ.openPerk(pos)">
                Open Perk
              </p-button>
            } @else if (levelable) {
              <div class="flex flex-col">
                <div class="text-center">
                  Cost:&nbsp;
                  <span [innerHTML]="hotmServ.formattedPowderCost() | parse | safeHtml"></span>
                </div>
                <div class="flex justify-center gap-2 my-2">
                  <p-button severity="primary" (onClick)="hotmServ.modifyLevel(pos, 1)">+1</p-button>
                  <p-button severity="primary" (onClick)="hotmServ.modifyLevel(pos, -1)">-1</p-button>
                  <p-button severity="primary" (onClick)="hotmServ.modifyLevel(pos, 10)">+10</p-button>
                  <p-button severity="primary" (onClick)="hotmServ.modifyLevel(pos, -10)">-10</p-button>
                </div>
              </div>
            }
          </div>
        </div-->
      } @else {
        <div class="flex flex-col justify-center items-center">
          <span class="mc gray">Select a perk to see its description!</span>
        </div>
      }
    </div>
  </div>
</div>
